language: python

python: '3.6'
install: pip install tox
script: tox
deploy:
  provider: pypi
  user: $PYPI_USER
  password: $PYPI_PASSWORD
  skip_cleanup: true
  on:
    tags: true
# Triggers building Docker containers for both current tag, and "latest"
after_deploy: >
  curl -H "Content-Type: application/json"
  --data '{"docker_tag": "latest"}'
  -X POST https://registry.hub.docker.com/u/brewblox/brewblox-service/trigger/$DOCKER_TOKEN/
  &
  curl -H "Content-Type: application/json"
  --data '{"source_type": "Tag", "source_name": "$TRAVIS_TAG"}'
  -X POST https://registry.hub.docker.com/u/brewblox/brewblox-service/trigger/$DOCKER_TOKEN/