language: python

jobs:
  include:
    -
      stage: test
      python: '3.6'
      install: pip install tox
      script: tox
    -
      stage: deploy
      python: '3.6'
      install: pip install bump2version
      script:
        # Check whether current tag matches current package version
        - python -c "assert '$(git describe --tags)' == '$(bump2version --dry-run --list minor | grep current_version | sed -r s,\"^.*=\",,)'"
      deploy:
        provider: pypi
        user: $PYPI_USER
        password: $PYPI_PASSWORD
        on:
          tags: true
